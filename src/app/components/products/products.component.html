<div class="products-container">
  <div class="header">
    <h1>Products</h1>
    <button class="btn-cart" (click)="toggleCart()">
      üõí Cart ({{ cartItems.length }})
    </button>
  </div>

  <!-- All Products Table -->
  <div class="section">
    <h2>All Products</h2>
    <div class="table-container" *ngIf="!loading; else loadingTemplate">
      <table class="data-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products">
            <td>
              <img [src]="product.imageUrl || 'assets/placeholder.jpg'" [alt]="product.name" class="product-thumbnail">
            </td>
            <td><strong>{{ product.name }}</strong></td>
            <td>{{ product.description }}</td>
            <td class="price">${{ product.retailPrice?.toFixed(2) }}</td>
            <td>
              <span *ngIf="isAdmin" [class.out-of-stock]="product.quantity === 0">
                {{ product.quantity > 0 ? product.quantity + ' available' : 'Out of stock' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-primary" *ngIf="!isAdmin" (click)="addToCart(product)" [disabled]="product.quantity === 0">
                  Add to Cart
                </button>
                <button class="btn-secondary" *ngIf="!isAdmin" (click)="addToWatchlist(product.id)">
                  ‚≠ê Watchlist
                </button>
                <button class="btn-link" (click)="viewProduct(product.id)">
                  View Details
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="products.length === 0">
            <td colspan="6" class="no-data">No products available</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Watchlist Section -->
  <div class="section" *ngIf="!isAdmin">
    <h2>My Watchlist</h2>
    <div class="watchlist-grid">
      <div class="watchlist-item" *ngFor="let product of watchlistProducts">
        <img [src]="product.imageUrl || 'assets/placeholder.jpg'" [alt]="product.name">
        <div class="watchlist-info">
          <h3>{{ product.name }}</h3>
          <p class="price">${{ product.retailPrice?.toFixed(2) }}</p>
          <div class="watchlist-actions">
            <button class="btn-primary" (click)="addToCart(product)">Add to Cart</button>
            <button class="btn-danger" (click)="removeFromWatchlist(product.id)">Remove</button>
          </div>
        </div>
      </div>
      <div *ngIf="watchlistProducts.length === 0" class="no-data">
        Your watchlist is empty
      </div>
    </div>
  </div>

  <!-- Shopping Cart Sidebar -->
  <div class="cart-sidebar" [class.show]="showCart">
    <div class="cart-header">
      <h2>Shopping Cart</h2>
      <button class="btn-close" (click)="toggleCart()">‚úï</button>
    </div>

    <div class="cart-items">
      <div class="cart-item" *ngFor="let item of cartItems">
        <img [src]="item.imageUrl || 'assets/placeholder.jpg'" [alt]="item.name">
        <div class="cart-item-info">
          <h4>{{ item.name }}</h4>
          <p class="price">${{ item.price?.toFixed(2) }}</p>
          <div class="quantity-control">
            <button (click)="updateCartQuantity(item.productId, item.quantity - 1)">-</button>
            <span>{{ item.quantity }}</span>
            <button (click)="updateCartQuantity(item.productId, item.quantity + 1)">+</button>
          </div>
        </div>
        <button class="btn-remove" (click)="removeFromCart(item.productId)">üóëÔ∏è</button>
      </div>

      <div *ngIf="cartItems.length === 0" class="empty-cart">
        Your cart is empty
      </div>
    </div>

    <div class="cart-footer" *ngIf="cartItems.length > 0">
      <div class="cart-total">
        <strong>Total:</strong>
        <strong class="total-amount">${{ cartService.getTotal().toFixed(2) }}</strong>
      </div>
      <button class="btn-checkout" (click)="checkout()">Place Order</button>
    </div>
  </div>

  <div class="cart-overlay" [class.show]="showCart" (click)="toggleCart()"></div>
</div>

<ng-template #loadingTemplate>
  <div class="loading">Loading products...</div>
</ng-template>
